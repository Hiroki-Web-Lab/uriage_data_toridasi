# 売上データ取り出しツール

売上管理システムからデータを取得して、Excelで開けるCSVファイルとしてダウンロードするツールです。

## 📋 必要なもの

- **Node.js**（バージョン 18以上）
  - インストール方法：[Node.js公式サイト](https://nodejs.org/) からダウンロード

## 🚀 セットアップ手順（初回のみ）

### 1. ファイルをコピー

このフォルダ全体を、使いたいPCにコピーします。

**コピーするファイル：**
- `package.json`
- `server.js`
- `scrapeUriage.js`
- `public/` フォルダ（中身も全部）

**コピーしなくて良いもの：**
- `node_modules/` フォルダ（後で自動生成されます）
- `package-lock.json`（あっても問題ありませんが、なくてもOK）

### 2. Node.jsがインストールされているか確認

コピーしたフォルダで PowerShell（またはコマンドプロンプト）を開き、以下を実行：

```powershell
node -v
npm -v
```

両方ともバージョン番号が表示されればOKです。  
エラーが出る場合は、[Node.js公式サイト](https://nodejs.org/) からインストールしてください。

### 3. ライブラリをインストール

同じフォルダで以下を実行：

```powershell
npm install
```

少し時間がかかりますが、完了すると `node_modules/` フォルダが自動で作成されます。

## 💻 使い方

### 1. サーバを起動

```powershell
npm start
```

以下のメッセージが出たら成功です：
```
✅ サーバ起動: http://localhost:3000
```

**⚠️ このウィンドウは閉じないでください。** サーバが動き続けている必要があります。

### 2. ブラウザで開く

ブラウザで以下のURLを開きます：
```
http://localhost:3000
```

### 3. データを取得

1. **期間**を選択（今月 / 先月）
2. **店舗**を選択（全店舗 or 各店舗）
3. **PHPSESSID**を入力
   - 売上管理システムにログイン後、ブラウザの開発者ツールなどから `PHPSESSID` の値をコピーして貼り付け
4. **「取り込み」ボタン**を押す
   - 少し待つと、ZIPファイルのダウンロードが始まります
   - 保存先を選んで保存してください

### 4. Excelで開く

ダウンロードしたZIPを展開すると、`YYYY-MM_店舗名.csv` というファイルが入っています。  
これをダブルクリックでExcelで開けます（文字化けしません）。

## 🔧 トラブルシューティング

### 「npm start でエラーが出る」

- `npm install` を実行しましたか？
- Node.jsはインストールされていますか？（`node -v` で確認）

### 「ブラウザで localhost:3000 が開けない」

- サーバが起動していますか？（PowerShellで `npm start` を実行したウィンドウが開いたままになっていますか？）
- サーバを起動したウィンドウを閉じていませんか？

### 「PHPSESSID がわからない」

1. 売上管理システムにログイン
2. ブラウザの開発者ツールを開く（F12キー）
3. 「Application」タブ（Chrome）または「ストレージ」タブ（Firefox）を開く
4. 左側の「Cookies」→ `https://hakataya.xsrv.jp` を選択
5. `PHPSESSID` の「Value」をコピー

### 「データが取得できない / エラーが出る」

- PHPSESSIDが正しいか確認（ログインし直して新しい値を取得）
- サーバのPowerShellウィンドウにエラーメッセージが出ていないか確認

## 📝 補足

- **PHPSESSIDの保存機能**：画面のチェックボックスをONにすると、次回アクセス時に自動で入力されます（共有PCではオフ推奨）
- **複数店舗**：「全店舗」を選ぶと、5店舗分のCSVが1つのZIPにまとまってダウンロードされます







